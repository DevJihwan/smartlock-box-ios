# Bug Fix History - 2025.11.01

## 개요
SmartLockBox iOS 프로젝트의 빌드 오류 수정 내역을 정리한 문서입니다.

---

## 🐛 수정된 버그 목록

### 1. AIEvaluationService.swift - 유니코드 이스케이프 오류

**오류 위치:** `SmartLockBox/Services/AIEvaluationService.swift:169:325`

**오류 메시지:**
```
Expected hexadecimal code in braces after unicode escape
```

**원인:**
- 잘못된 유니코드 이스케이프 시퀀스 `\ub85c` 사용
- Swift에서 유니코드는 `\u{XXXX}` 형식으로 작성해야 함

**수정 내용:**
```swift
// 수정 전
"응답은 반드시 JSON 형식으로 {\"result\": \"PASS\", \"feedback\": \"...\"}\\ub85c 작성하세요."

// 수정 후
"응답은 반드시 JSON 형식으로 {\"result\": \"PASS\", \"feedback\": \"...\"} 또는 {\"result\": \"FAIL\", \"feedback\": \"...\"}로 작성하세요."
```

**커밋:**
- SHA: `fb790edcd07d45c9852ed9a49b617b26047754df`
- Message: "Fix unicode escape error in AIEvaluationService.swift"

---

### 2. Colors.swift - SwiftUI View Modifier 오류

**오류 위치:** `SmartLockBox/Utils/Colors.swift`

#### 2-1. Color.shadow() 메서드 존재하지 않음 (103번 줄)

**오류 메시지:**
```
Instance member 'shadow' cannot be used on type 'Color'
```

**원인:**
- `shadow()`는 `View` modifier이지 `Color`의 static 메서드가 아님
- `Color` extension에서 `shadow()`를 직접 호출할 수 없음

**수정 내용:**
- `dynamicShadow()` 함수를 `ViewModifier`로 변경
- `@Environment(\.colorScheme)`를 사용하여 다크모드 감지

```swift
// 수정 전
extension Color {
    static func dynamicShadow(...) -> some View {
        return AnyView(shadow(...))
    }
}

// 수정 후
struct DynamicShadowModifier: ViewModifier {
    @Environment(\.colorScheme) var colorScheme
    let radius: CGFloat
    let opacity: Double
    
    func body(content: Content) -> some View {
        content.shadow(...)
    }
}
```

#### 2-2. colorScheme 환경 변수 미선언 (117, 122번 줄)

**오류 메시지:**
```
Cannot convert value of type '(ColorScheme) -> some View' to expected argument type 'ColorScheme'
```

**원인:**
- `cardStyle()`, `adaptiveShadow()` 함수에서 `colorScheme` 변수를 선언 없이 사용
- SwiftUI의 `@Environment(\.colorScheme)`를 통해 접근해야 함

**수정 내용:**
- View extension의 함수들을 `ViewModifier`로 리팩토링
- 각 Modifier에서 `@Environment(\.colorScheme)` 선언

```swift
// 수정 전
extension View {
    func cardStyle() -> some View {
        self.shadow(color: colorScheme == .dark ? ... : ...)
    }
}

// 수정 후
extension View {
    func cardStyle() -> some View {
        self.modifier(CardStyleModifier())
    }
}

struct CardStyleModifier: ViewModifier {
    @Environment(\.colorScheme) var colorScheme
    
    func body(content: Content) -> some View {
        content
            .padding()
            .background(AppColors.cardBackground)
            .cornerRadius(16)
            .shadow(
                color: Color.black.opacity(colorScheme == .dark ? 0.3 : 0.1),
                radius: 10,
                x: 0,
                y: 5
            )
    }
}
```

#### 2-3. EnvironmentKey 타입 사용 오류 (126번 줄)

**오류 메시지:**
```
Use of protocol 'EnvironmentKey' as a type must be written 'any EnvironmentKey'
```

**원인:**
- 불필요한 `environment(key:)` 함수 정의
- `EnvironmentKey` 프로토콜을 타입으로 직접 사용하려고 시도

**수정 내용:**
- 잘못 작성된 `environment(key:)` 함수 제거
- ViewModifier 패턴으로 완전히 대체

**생성된 ViewModifier들:**
1. `CardStyleModifier` - 카드 스타일 적용
2. `AdaptiveShadowModifier` - 적응형 그림자 효과
3. `DynamicShadowModifier` - 동적 그림자 효과

**커밋:**
- SHA: `a20e53baec0b2a49decf2b1c2dfed053bbb96f68`
- Message: "Fix Colors.swift: remove invalid Color.shadow usage and fix environment key issues"

---

### 3. Core Data Entity Class 파일 누락

**오류 위치:**
```
/Build/Intermediates.noindex/SmartLockBox.build/Debug-iphonesimulator/SmartLockBox.build/DerivedSources/CoreDataGenerated/SmartLockBox/
```

#### 3-1. UnlockAttempt+CoreDataProperties.swift 오류

**오류 메시지:**
```
Cannot find type 'UnlockAttempt' in scope
```

**원인:**
- `UnlockAttempt+CoreDataClass.swift` 파일이 프로젝트에 존재하지 않음
- Xcode가 자동 생성한 Properties 파일이 Class 파일을 찾을 수 없음

#### 3-2. UsageRecord+CoreDataProperties.swift 오류

**오류 메시지:**
```
Cannot find type 'UsageRecord' in scope
```

**원인:**
- `UsageRecord+CoreDataClass.swift` 파일이 프로젝트에 존재하지 않음
- Xcode가 자동 생성한 Properties 파일이 Class 파일을 찾을 수 없음

**수정 내용:**
누락된 Core Data Entity Class 파일들을 생성:

1. **UnlockAttempt+CoreDataClass.swift**
```swift
import Foundation
import CoreData

@objc(UnlockAttempt)
public class UnlockAttempt: NSManagedObject {
    // Core Data entity class for UnlockAttempt
    // Properties are defined in UnlockAttempt+CoreDataProperties.swift
}
```

2. **UsageRecord+CoreDataClass.swift**
```swift
import Foundation
import CoreData

@objc(UsageRecord)
public class UsageRecord: NSManagedObject {
    // Core Data entity class for UsageRecord
    // Properties are defined in UsageRecord+CoreDataProperties.swift
}
```

**Entity 속성 (추정):**

**UnlockAttempt:**
- `id: UUID`
- `timestamp: Date`
- `word1: String`
- `word2: String`
- `sentence: String`
- `chatGPTResult: String`
- `claudeResult: String`
- `isSuccessful: Bool`

**UsageRecord:**
- `id: UUID`
- `date: Date`
- `usageMinutes: Int32`
- `goalMinutes: Int32`
- `isGoalAchieved: Bool`

**커밋:**
- SHA: `aeee9855c4e889bc5205547925f9bbb3c95d2f98`
- Message: "Add missing Core Data entity class files for UnlockAttempt and UsageRecord"

---

## 📋 Core Data Codegen 설정 권장사항

`.xcdatamodeld` 파일에서 각 Entity의 **Codegen** 설정:

- **Category/Extension** (권장) ✅
  - Xcode가 Properties 파일만 자동 생성
  - Class 파일은 개발자가 직접 관리
  - 더 나은 버전 관리 가능

- **Class Definition**
  - Xcode가 Class와 Properties 파일 모두 자동 생성
  - DerivedData에만 존재하여 Git에 포함되지 않음
  - 버전 관리 어려움

- **Manual/None**
  - 모든 파일을 개발자가 직접 생성 및 관리
  - 완전한 커스터마이징 가능하지만 유지보수 부담 증가

---

## 🔧 빌드 오류 해결 절차

수정 후 빌드가 안 될 경우 다음 단계를 따라 진행:

1. **Clean Build Folder**
   ```
   Xcode > Product > Clean Build Folder (⌘ + Shift + K)
   ```

2. **DerivedData 삭제**
   ```bash
   rm -rf ~/Library/Developer/Xcode/DerivedData/SmartLockBox-*
   ```

3. **프로젝트 재빌드**
   ```
   Xcode > Product > Build (⌘ + B)
   ```

---

## 📊 수정 통계

| 분류 | 파일 수 | 수정 라인 | 추가 파일 |
|------|---------|-----------|-----------|
| 유니코드 오류 | 1 | ~3 | 0 |
| SwiftUI 오류 | 1 | ~50 | 3 modifiers |
| Core Data 오류 | 0 | 0 | 2 |
| **합계** | **2** | **~53** | **2+3** |

---

## ✅ 검증 완료

모든 빌드 오류가 해결되었으며, 프로젝트가 정상적으로 컴파일됩니다.

### 수정된 빌드 오류 요약:
1. ✅ AIEvaluationService.swift - 유니코드 이스케이프 오류
2. ✅ Colors.swift - Color.shadow() 사용 오류
3. ✅ Colors.swift - colorScheme 환경 변수 오류 (2건)
4. ✅ Colors.swift - EnvironmentKey 타입 오류
5. ✅ UnlockAttempt Core Data Class 누락
6. ✅ UsageRecord Core Data Class 누락

**총 7개의 빌드 오류 해결 완료**

---

## 📚 참고 자료

- [Swift Unicode Escapes](https://docs.swift.org/swift-book/documentation/the-swift-programming-language/stringsandcharacters/#Unicode)
- [SwiftUI Environment Values](https://developer.apple.com/documentation/swiftui/environment)
- [Core Data Codegen](https://developer.apple.com/documentation/coredata/modeling_data/generating_code)
- [SwiftUI ViewModifier](https://developer.apple.com/documentation/swiftui/viewmodifier)

---

**작성일:** 2025년 11월 1일  
**작성자:** DevJihwan  
**프로젝트:** SmartLockBox iOS
