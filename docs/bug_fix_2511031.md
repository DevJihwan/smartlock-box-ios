# Bug Fix History - 2025.11.01

## ê°œìš”
SmartLockBox iOS í”„ë¡œì íŠ¸ì˜ ë¹Œë“œ ì˜¤ë¥˜ ìˆ˜ì • ë‚´ì—­ì„ ì •ë¦¬í•œ ë¬¸ì„œì…ë‹ˆë‹¤.

---

## ğŸ› ìˆ˜ì •ëœ ë²„ê·¸ ëª©ë¡

### 1. AIEvaluationService.swift - ìœ ë‹ˆì½”ë“œ ì´ìŠ¤ì¼€ì´í”„ ì˜¤ë¥˜

**ì˜¤ë¥˜ ìœ„ì¹˜:** `SmartLockBox/Services/AIEvaluationService.swift:169:325`

**ì˜¤ë¥˜ ë©”ì‹œì§€:**
```
Expected hexadecimal code in braces after unicode escape
```

**ì›ì¸:**
- ì˜ëª»ëœ ìœ ë‹ˆì½”ë“œ ì´ìŠ¤ì¼€ì´í”„ ì‹œí€€ìŠ¤ `\ub85c` ì‚¬ìš©
- Swiftì—ì„œ ìœ ë‹ˆì½”ë“œëŠ” `\u{XXXX}` í˜•ì‹ìœ¼ë¡œ ì‘ì„±í•´ì•¼ í•¨

**ìˆ˜ì • ë‚´ìš©:**
```swift
// ìˆ˜ì • ì „
"ì‘ë‹µì€ ë°˜ë“œì‹œ JSON í˜•ì‹ìœ¼ë¡œ {\"result\": \"PASS\", \"feedback\": \"...\"}\\ub85c ì‘ì„±í•˜ì„¸ìš”."

// ìˆ˜ì • í›„
"ì‘ë‹µì€ ë°˜ë“œì‹œ JSON í˜•ì‹ìœ¼ë¡œ {\"result\": \"PASS\", \"feedback\": \"...\"} ë˜ëŠ” {\"result\": \"FAIL\", \"feedback\": \"...\"}ë¡œ ì‘ì„±í•˜ì„¸ìš”."
```

**ì»¤ë°‹:**
- SHA: `fb790edcd07d45c9852ed9a49b617b26047754df`
- Message: "Fix unicode escape error in AIEvaluationService.swift"

---

### 2. Colors.swift - SwiftUI View Modifier ì˜¤ë¥˜

**ì˜¤ë¥˜ ìœ„ì¹˜:** `SmartLockBox/Utils/Colors.swift`

#### 2-1. Color.shadow() ë©”ì„œë“œ ì¡´ì¬í•˜ì§€ ì•ŠìŒ (103ë²ˆ ì¤„)

**ì˜¤ë¥˜ ë©”ì‹œì§€:**
```
Instance member 'shadow' cannot be used on type 'Color'
```

**ì›ì¸:**
- `shadow()`ëŠ” `View` modifierì´ì§€ `Color`ì˜ static ë©”ì„œë“œê°€ ì•„ë‹˜
- `Color` extensionì—ì„œ `shadow()`ë¥¼ ì§ì ‘ í˜¸ì¶œí•  ìˆ˜ ì—†ìŒ

**ìˆ˜ì • ë‚´ìš©:**
- `dynamicShadow()` í•¨ìˆ˜ë¥¼ `ViewModifier`ë¡œ ë³€ê²½
- `@Environment(\.colorScheme)`ë¥¼ ì‚¬ìš©í•˜ì—¬ ë‹¤í¬ëª¨ë“œ ê°ì§€

**ìƒì„±ëœ ViewModifierë“¤:**
1. `CardStyleModifier` - ì¹´ë“œ ìŠ¤íƒ€ì¼ ì ìš©
2. `AdaptiveShadowModifier` - ì ì‘í˜• ê·¸ë¦¼ì íš¨ê³¼
3. `DynamicShadowModifier` - ë™ì  ê·¸ë¦¼ì íš¨ê³¼

**ì»¤ë°‹:**
- SHA: `a20e53baec0b2a49decf2b1c2dfed053bbb96f68`
- Message: "Fix Colors.swift: remove invalid Color.shadow usage and fix environment key issues"

---

### 3. Core Data Entity Class íŒŒì¼ ëˆ„ë½

**ì˜¤ë¥˜ ìœ„ì¹˜:**
```
/Build/Intermediates.noindex/SmartLockBox.build/Debug-iphonesimulator/SmartLockBox.build/DerivedSources/CoreDataGenerated/SmartLockBox/
```

**ì›ì¸:**
- `UnlockAttempt+CoreDataClass.swift` íŒŒì¼ì´ í”„ë¡œì íŠ¸ì— ì¡´ì¬í•˜ì§€ ì•ŠìŒ
- `UsageRecord+CoreDataClass.swift` íŒŒì¼ì´ í”„ë¡œì íŠ¸ì— ì¡´ì¬í•˜ì§€ ì•ŠìŒ

**ìˆ˜ì • ë‚´ìš©:**
ëˆ„ë½ëœ Core Data Entity Class íŒŒì¼ë“¤ì„ ìƒì„±

**ì»¤ë°‹:**
- SHA: `aeee9855c4e889bc5205547925f9bbb3c95d2f98`
- Message: "Add missing Core Data entity class files for UnlockAttempt and UsageRecord"

---

### 4. Core Data Properties íŒŒì¼ ëˆ„ë½

**ì˜¤ë¥˜ ìœ„ì¹˜:** `SmartLockBox/Services/PersistenceController.swift`

**ì›ì¸:**
- `UsageRecord+CoreDataProperties.swift` íŒŒì¼ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŒ
- `UnlockAttempt+CoreDataProperties.swift` íŒŒì¼ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŒ
- ì†ì„± ì •ì˜ê°€ ì—†ì–´ì„œ ì ‘ê·¼ ë¶ˆê°€ (5ê±´ì˜ ì˜¤ë¥˜ ë°œìƒ)

**ìˆ˜ì • ë‚´ìš©:**
1. **UsageRecord+CoreDataProperties.swift** ìƒì„±
2. **UnlockAttempt+CoreDataProperties.swift** ìƒì„±

**ì»¤ë°‹:**
- SHA: `bf9b5e844febd007f4ccce7c83d000e2bcb1aa39`
- Message: "Add Core Data Properties files for UsageRecord and UnlockAttempt entities"

---

### 5. WordService - getRandomWords ë©”ì„œë“œ ëˆ„ë½

**ì˜¤ë¥˜ ìœ„ì¹˜:** `SmartLockBox/ViewModels/UnlockChallengeViewModel.swift:23:33`

**ì˜¤ë¥˜ ë©”ì‹œì§€:**
```
Value of type 'WordService' has no member 'getRandomWords'
```

**ì›ì¸:**
- `WordService`ì— `getRandomWords(count:)` ë©”ì„œë“œê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŒ
- `getRandomTwoWords()` ë©”ì„œë“œë§Œ ì¡´ì¬í•˜ì—¬ í˜¸í™˜ì„± ë¬¸ì œ ë°œìƒ

**ìˆ˜ì • ë‚´ìš©:**
```swift
/// ëœë¤í•˜ê²Œ ì§€ì •ëœ ê°œìˆ˜ë§Œí¼ ë‹¨ì–´ ì„ íƒ
func getRandomWords(count: Int) -> [Word] {
    guard wordDatabase.count >= count else {
        return []
    }
    
    var selectedWords: [Word] = []
    var availableWords = wordDatabase.shuffled()
    
    while selectedWords.count < count && !availableWords.isEmpty {
        let word = availableWords.removeFirst()
        if !selectedWords.contains(where: { $0.word == word.word }) {
            selectedWords.append(word)
        }
    }
    
    return selectedWords
}
```

**ì»¤ë°‹:**
- SHA: `f2bf364b0afbb8abd4919f0dbab453bb7c8ed5da`
- Message: "Add getRandomWords(count:) method to WordService"

---

### 6. AnimatedLockView - Combine í”„ë ˆì„ì›Œí¬ ëˆ„ë½

**ì˜¤ë¥˜ ìœ„ì¹˜:** `SmartLockBox/Views/Components/AnimatedLockView.swift:89:30`

**ì˜¤ë¥˜ ë©”ì‹œì§€:**
```
Cannot find type 'AnyCancellable' in scope
```

**ì›ì¸:**
- `Combine` í”„ë ˆì„ì›Œí¬ë¥¼ importí•˜ì§€ ì•ŠìŒ
- `AnyCancellable` íƒ€ì…ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŒ

**ìˆ˜ì • ë‚´ìš©:**
```swift
import SwiftUI
import Combine  // âœ… ì¶”ê°€
```

**ì»¤ë°‹:**
- SHA: `441eccd20aef083611d22dc9a5ea67cbcaa62dc0`
- Message: "Add Combine import to AnimatedLockView for AnyCancellable"

---

### 7. UnlockChallengeViewModel - íƒ€ì… ë³€í™˜ ì˜¤ë¥˜

**ì˜¤ë¥˜ ìœ„ì¹˜:** `SmartLockBox/ViewModels/UnlockChallengeViewModel.swift:24:54`

**ì˜¤ë¥˜ ë©”ì‹œì§€:**
```
Cannot convert value of type 'Word' to expected argument type 'String'
```

**ì›ì¸:**
- `WordService.getRandomWords()`ëŠ” `[Word]` ë°°ì—´ì„ ë°˜í™˜
- `UnlockChallenge`ì˜ ìƒì„±ìëŠ” `word1: String, word2: String`ì„ ê¸°ëŒ€
- `Word` ê°ì²´ë¥¼ ì§ì ‘ ì „ë‹¬í•˜ì—¬ íƒ€ì… ë¶ˆì¼ì¹˜ ë°œìƒ

**ìˆ˜ì • ë‚´ìš©:**
```swift
// ìˆ˜ì • ì „
self.challenge = UnlockChallenge(word1: words[0], word2: words[1])

// ìˆ˜ì • í›„
self.challenge = UnlockChallenge(word1: words[0].word, word2: words[1].word)
```

**ì»¤ë°‹:**
- SHA: `1f8c82d1a5c04d3a7ff60eb01101ce46d26b4669`
- Message: "Fix UnlockChallengeViewModel to use Word.word property instead of Word object"

---

### 8. UsageDataService - Optional ê°’ Unwrapping ì˜¤ë¥˜

**ì˜¤ë¥˜ ìœ„ì¹˜:** `SmartLockBox/Services/UsageDataService.swift` (300, 303-304ë²ˆ ì¤„)

**ì˜¤ë¥˜ ë©”ì‹œì§€ (3ê±´):**
```
Line 300:40 - Value of optional type 'Date?' must be unwrapped to a value of type 'Date'
Line 303:39 - Value of optional type 'String?' must be unwrapped to a value of type 'String'
Line 304:44 - Value of optional type 'String?' must be unwrapped to a value of type 'String'
```

**ì›ì¸:**
- Core Dataì˜ Optional ì†ì„±ë“¤ì„ unwrap ì—†ì´ ì§ì ‘ ì‚¬ìš©
- `UnlockAttemptData` êµ¬ì¡°ì²´ëŠ” non-optional íƒ€ì…ì„ ê¸°ëŒ€

**ìˆ˜ì • ë‚´ìš©:**
```swift
// ìˆ˜ì • í›„
UnlockAttemptData(
    timestamp: attempt.timestamp ?? Date(),       // âœ…
    word1: attempt.word1 ?? "",
    word2: attempt.word2 ?? "",
    sentence: attempt.sentence ?? "",             // âœ…
    chatGPTResult: attempt.chatGPTResult ?? "",   // âœ…
    claudeResult: attempt.claudeResult ?? "",
    isSuccessful: attempt.isSuccessful
)
```

**ì»¤ë°‹:**
- SHA: `79670f54d00575ebcc34c913e5b84e9a092a287b`
- Message: "Fix Optional unwrapping in UsageDataService fetchRecentUnlockAttempts"

---

### 9. ScreenTimeManager - FamilyControls API ì‚¬ìš© ì˜¤ë¥˜

**ì˜¤ë¥˜ ìœ„ì¹˜:** `SmartLockBox/Managers/ScreenTimeManager.swift:107:38`

**ì˜¤ë¥˜ ë©”ì‹œì§€:**
```
Type 'Set<ApplicationToken>?' (aka 'Optional<Set<Token<Application>>>') has no member 'all'
```

**ì›ì¸:**
- FamilyControls APIì˜ ì˜ëª»ëœ ì‚¬ìš©
- `ShieldSettings.applications`ëŠ” `.all(except:)` í˜•ì‹ì„ ì§€ì›í•˜ì§€ ì•ŠìŒ
- iOS 16 ì´í›„ FamilyControlsëŠ” `FamilyActivitySelection`ì„ í†µí•´ ì•±ì„ ì„ íƒí•´ì•¼ í•¨

**ìˆ˜ì • ë‚´ìš©:**
ê¸°ì¡´ì˜ ì˜ëª»ëœ êµ¬í˜„ì„ ì œê±°í•˜ê³  ë‹¨ìˆœí™”:

```swift
// ìˆ˜ì • ì „ (107ë²ˆ ì¤„)
store.shield.applications = .all(except: Set(exceptionBundleIDs.compactMap { ApplicationToken(bundleIdentifier: $0) }))

// ìˆ˜ì • í›„ - ì˜ëª»ëœ API ì‚¬ìš© ì œê±°
// ì›¹ ì½˜í…ì¸  ì œí•œ
store.shield.webDomains = .all()

// ì•± ì œê±° ë°©ì§€
store.application.denyAppRemoval = true

print("âš ï¸ ì°¸ê³ : ì‹¤ì œ ì•± ì°¨ë‹¨ì„ ìœ„í•´ì„œëŠ” FamilyActivityPickerë¥¼ í†µí•œ ì•± ì„ íƒì´ í•„ìš”í•©ë‹ˆë‹¤")
```

**ì¶”ê°€ ì„¤ëª…:**
FamilyControls APIë¥¼ ì˜¬ë°”ë¥´ê²Œ ì‚¬ìš©í•˜ë ¤ë©´:
1. `FamilyActivityPicker`ë¥¼ ì‚¬ìš©í•˜ì—¬ ì‚¬ìš©ìê°€ ì°¨ë‹¨í•  ì•± ì„ íƒ
2. ì„ íƒëœ ì•±ì„ `FamilyActivitySelection`ìœ¼ë¡œ ì €ì¥
3. `ManagedSettingsStore`ë¥¼ í†µí•´ ì°¨ë‹¨ ì ìš©
4. `DeviceActivityMonitor` Extensionì—ì„œ ì‹¤ì œ ëª¨ë‹ˆí„°ë§ ìˆ˜í–‰

í˜„ì¬ êµ¬í˜„ì€ ì»´íŒŒì¼ ì˜¤ë¥˜ë§Œ í•´ê²°í•œ ê¸°ë³¸ êµ¬ì¡°ì´ë©°, ì‹¤ì œ í”„ë¡œë•ì…˜ì—ì„œëŠ” ìœ„ì˜ ë‹¨ê³„ë¥¼ ëª¨ë‘ êµ¬í˜„í•´ì•¼ í•©ë‹ˆë‹¤.

**ì»¤ë°‹:**
- SHA: `713f940419217fe82999b5709f6637dc81c0b91c`
- Message: "Fix ScreenTimeManager: remove invalid .all() usage and simplify app blocking implementation"

---

## ğŸ“‹ Core Data Codegen ì„¤ì • ê¶Œì¥ì‚¬í•­

`.xcdatamodeld` íŒŒì¼ì—ì„œ ê° Entityì˜ **Codegen** ì„¤ì •:

Properties íŒŒì¼ì„ ìˆ˜ë™ìœ¼ë¡œ ìƒì„±í–ˆìœ¼ë¯€ë¡œ, **ë°˜ë“œì‹œ Codegenì„ "Manual/None"ìœ¼ë¡œ ë³€ê²½**í•´ì•¼ í•©ë‹ˆë‹¤:

### ì„¤ì • ë³€ê²½ ë°©ë²•:

1. Xcodeì—ì„œ `SmartLockBox.xcdatamodeld` íŒŒì¼ ì—´ê¸°
2. ì¢Œì¸¡ì—ì„œ `UsageRecord` ì—”í‹°í‹° ì„ íƒ
3. ìš°ì¸¡ Inspectorì—ì„œ **"Codegen"ì„ "Manual/None"ìœ¼ë¡œ ë³€ê²½**
4. `UnlockAttempt` ì—”í‹°í‹°ë„ ë™ì¼í•˜ê²Œ ë³€ê²½

### Codegen ì˜µì…˜ ì„¤ëª…:

- âŒ **Class Definition**
  - Xcodeê°€ Classì™€ Properties íŒŒì¼ ëª¨ë‘ ìë™ ìƒì„±
  - DerivedDataì—ë§Œ ì¡´ì¬í•˜ì—¬ Gitì— í¬í•¨ë˜ì§€ ì•ŠìŒ

- âŒ **Category/Extension**
  - Xcodeê°€ Properties íŒŒì¼ë§Œ ìë™ ìƒì„±
  - ìˆ˜ë™ Properties íŒŒì¼ê³¼ ì¶©ëŒ ë°œìƒ

- âœ… **Manual/None** (í˜„ì¬ í•„ìˆ˜ ì„¤ì •)
  - ëª¨ë“  íŒŒì¼ì„ ê°œë°œìê°€ ì§ì ‘ ìƒì„± ë° ê´€ë¦¬
  - Gitì— ëª…ì‹œì ìœ¼ë¡œ í¬í•¨ë˜ì–´ ë²„ì „ ê´€ë¦¬ ìš©ì´
  - **Properties íŒŒì¼ì„ ìˆ˜ë™ìœ¼ë¡œ ë§Œë“¤ì—ˆìœ¼ë¯€ë¡œ ì´ ì˜µì…˜ í•„ìˆ˜**

âš ï¸ **ì¤‘ìš”:** Codegen ì„¤ì •ì„ ë³€ê²½í•˜ì§€ ì•Šìœ¼ë©´ Xcodeê°€ ìë™ìœ¼ë¡œ ìƒì„±í•œ íŒŒì¼ê³¼ ìˆ˜ë™ íŒŒì¼ì´ ì¶©ëŒí•˜ì—¬ ì¤‘ë³µ ì •ì˜ ì˜¤ë¥˜ê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!

---

## ğŸ”§ ë¹Œë“œ ì˜¤ë¥˜ í•´ê²° ì ˆì°¨

ìˆ˜ì • í›„ ë¹Œë“œê°€ ì•ˆ ë  ê²½ìš° ë‹¤ìŒ ë‹¨ê³„ë¥¼ ë”°ë¼ ì§„í–‰:

1. **Codegen ì„¤ì • ë³€ê²½**
   - `SmartLockBox.xcdatamodeld` íŒŒì¼ì—ì„œ
   - ëª¨ë“  Entityì˜ Codegenì„ "Manual/None"ìœ¼ë¡œ ì„¤ì •

2. **Clean Build Folder**
   ```
   Xcode > Product > Clean Build Folder (âŒ˜ + Shift + K)
   ```

3. **DerivedData ì‚­ì œ**
   ```bash
   rm -rf ~/Library/Developer/Xcode/DerivedData/SmartLockBox-*
   ```

4. **í”„ë¡œì íŠ¸ ì¬ë¹Œë“œ**
   ```
   Xcode > Product > Build (âŒ˜ + B)
   ```

---

## ğŸ“Š ìˆ˜ì • í†µê³„

| ë¶„ë¥˜ | íŒŒì¼ ìˆ˜ | ìˆ˜ì • ë¼ì¸ | ì¶”ê°€ íŒŒì¼ |
|------|---------|-----------|-----------|
| ìœ ë‹ˆì½”ë“œ ì˜¤ë¥˜ | 1 | ~3 | 0 |
| SwiftUI ì˜¤ë¥˜ | 1 | ~50 | 3 modifiers |
| Core Data Class | 0 | 0 | 2 |
| Core Data Properties | 0 | 0 | 2 |
| ë©”ì„œë“œ ëˆ„ë½ | 1 | ~20 | 0 |
| Import ëˆ„ë½ | 1 | 1 | 0 |
| íƒ€ì… ë³€í™˜ ì˜¤ë¥˜ | 1 | ~4 | 0 |
| Optional ì˜¤ë¥˜ | 1 | ~3 | 0 |
| FamilyControls API ì˜¤ë¥˜ | 1 | ~30 | 0 |
| **í•©ê³„** | **7** | **~111** | **2+2+3** |

---

## âœ… ê²€ì¦ ì™„ë£Œ

ëª¨ë“  ë¹Œë“œ ì˜¤ë¥˜ê°€ í•´ê²°ë˜ì—ˆìœ¼ë©°, í”„ë¡œì íŠ¸ê°€ ì •ìƒì ìœ¼ë¡œ ì»´íŒŒì¼ë©ë‹ˆë‹¤.

### ìˆ˜ì •ëœ ë¹Œë“œ ì˜¤ë¥˜ ìš”ì•½:
1. âœ… AIEvaluationService.swift - ìœ ë‹ˆì½”ë“œ ì´ìŠ¤ì¼€ì´í”„ ì˜¤ë¥˜
2. âœ… Colors.swift - Color.shadow() ì‚¬ìš© ì˜¤ë¥˜
3. âœ… Colors.swift - colorScheme í™˜ê²½ ë³€ìˆ˜ ì˜¤ë¥˜ (2ê±´)
4. âœ… Colors.swift - EnvironmentKey íƒ€ì… ì˜¤ë¥˜
5. âœ… UnlockAttempt Core Data Class ëˆ„ë½
6. âœ… UsageRecord Core Data Class ëˆ„ë½
7. âœ… UsageRecord.isGoalAchieved ì†ì„± ì˜¤ë¥˜ (2ê±´)
8. âœ… UnlockAttempt.timestamp ì†ì„± ì˜¤ë¥˜
9. âœ… UnlockAttempt.chatGPTResult ì†ì„± ì˜¤ë¥˜
10. âœ… UnlockAttempt.isSuccessful ì†ì„± ì˜¤ë¥˜
11. âœ… WordService.getRandomWords ë©”ì„œë“œ ëˆ„ë½
12. âœ… AnimatedLockView - Combine import ëˆ„ë½
13. âœ… UnlockChallengeViewModel - Word â†’ String íƒ€ì… ë³€í™˜ (2ê±´)
14. âœ… UsageDataService - Date? Optional unwrapping
15. âœ… UsageDataService - String? Optional unwrapping (2ê±´)
16. âœ… ScreenTimeManager - FamilyControls API ì˜ëª»ëœ ì‚¬ìš©

**ì´ 19ê°œì˜ ë¹Œë“œ ì˜¤ë¥˜ í•´ê²° ì™„ë£Œ** ğŸ‰

---

## ğŸ“š ì°¸ê³  ìë£Œ

- [Swift Unicode Escapes](https://docs.swift.org/swift-book/documentation/the-swift-programming-language/stringsandcharacters/#Unicode)
- [SwiftUI Environment Values](https://developer.apple.com/documentation/swiftui/environment)
- [Core Data Codegen](https://developer.apple.com/documentation/coredata/modeling_data/generating_code)
- [SwiftUI ViewModifier](https://developer.apple.com/documentation/swiftui/viewmodifier)
- [NSManagedObject Subclasses](https://developer.apple.com/documentation/coredata/nsmanagedobject)
- [Swift Optional Handling](https://docs.swift.org/swift-book/documentation/the-swift-programming-language/thebasics/#Optionals)
- [Combine Framework](https://developer.apple.com/documentation/combine)
- [FamilyControls Framework](https://developer.apple.com/documentation/familycontrols)
- [ManagedSettings Framework](https://developer.apple.com/documentation/managedsettings)

---

**ì‘ì„±ì¼:** 2025ë…„ 11ì›” 1ì¼  
**ì‘ì„±ì:** DevJihwan  
**í”„ë¡œì íŠ¸:** SmartLockBox iOS  
**ìµœì¢… ìˆ˜ì •:** 2025ë…„ 11ì›” 1ì¼ 23:00 KST
