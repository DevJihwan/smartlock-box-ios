# Bug Fix History - 2025.11.01

## 개요
SmartLockBox iOS 프로젝트의 빌드 오류 수정 내역을 정리한 문서입니다.

---

## 🐛 수정된 버그 목록

### 1. AIEvaluationService.swift - 유니코드 이스케이프 오류

**오류 위치:** `SmartLockBox/Services/AIEvaluationService.swift:169:325`

**오류 메시지:**
```
Expected hexadecimal code in braces after unicode escape
```

**원인:**
- 잘못된 유니코드 이스케이프 시퀀스 `\ub85c` 사용
- Swift에서 유니코드는 `\u{XXXX}` 형식으로 작성해야 함

**수정 내용:**
```swift
// 수정 전
"응답은 반드시 JSON 형식으로 {\"result\": \"PASS\", \"feedback\": \"...\"}\\ub85c 작성하세요."

// 수정 후
"응답은 반드시 JSON 형식으로 {\"result\": \"PASS\", \"feedback\": \"...\"} 또는 {\"result\": \"FAIL\", \"feedback\": \"...\"}로 작성하세요."
```

**커밋:**
- SHA: `fb790edcd07d45c9852ed9a49b617b26047754df`
- Message: "Fix unicode escape error in AIEvaluationService.swift"

---

### 2. Colors.swift - SwiftUI View Modifier 오류

**오류 위치:** `SmartLockBox/Utils/Colors.swift`

#### 2-1. Color.shadow() 메서드 존재하지 않음 (103번 줄)

**오류 메시지:**
```
Instance member 'shadow' cannot be used on type 'Color'
```

**원인:**
- `shadow()`는 `View` modifier이지 `Color`의 static 메서드가 아님
- `Color` extension에서 `shadow()`를 직접 호출할 수 없음

**수정 내용:**
- `dynamicShadow()` 함수를 `ViewModifier`로 변경
- `@Environment(\.colorScheme)`를 사용하여 다크모드 감지

```swift
// 수정 전
extension Color {
    static func dynamicShadow(...) -> some View {
        return AnyView(shadow(...))
    }
}

// 수정 후
struct DynamicShadowModifier: ViewModifier {
    @Environment(\.colorScheme) var colorScheme
    let radius: CGFloat
    let opacity: Double
    
    func body(content: Content) -> some View {
        content.shadow(...)
    }
}
```

#### 2-2. colorScheme 환경 변수 미선언 (117, 122번 줄)

**오류 메시지:**
```
Cannot convert value of type '(ColorScheme) -> some View' to expected argument type 'ColorScheme'
```

**원인:**
- `cardStyle()`, `adaptiveShadow()` 함수에서 `colorScheme` 변수를 선언 없이 사용
- SwiftUI의 `@Environment(\.colorScheme)`를 통해 접근해야 함

**수정 내용:**
- View extension의 함수들을 `ViewModifier`로 리팩토링
- 각 Modifier에서 `@Environment(\.colorScheme)` 선언

```swift
// 수정 전
extension View {
    func cardStyle() -> some View {
        self.shadow(color: colorScheme == .dark ? ... : ...)
    }
}

// 수정 후
extension View {
    func cardStyle() -> some View {
        self.modifier(CardStyleModifier())
    }
}

struct CardStyleModifier: ViewModifier {
    @Environment(\.colorScheme) var colorScheme
    
    func body(content: Content) -> some View {
        content
            .padding()
            .background(AppColors.cardBackground)
            .cornerRadius(16)
            .shadow(
                color: Color.black.opacity(colorScheme == .dark ? 0.3 : 0.1),
                radius: 10,
                x: 0,
                y: 5
            )
    }
}
```

#### 2-3. EnvironmentKey 타입 사용 오류 (126번 줄)

**오류 메시지:**
```
Use of protocol 'EnvironmentKey' as a type must be written 'any EnvironmentKey'
```

**원인:**
- 불필요한 `environment(key:)` 함수 정의
- `EnvironmentKey` 프로토콜을 타입으로 직접 사용하려고 시도

**수정 내용:**
- 잘못 작성된 `environment(key:)` 함수 제거
- ViewModifier 패턴으로 완전히 대체

**생성된 ViewModifier들:**
1. `CardStyleModifier` - 카드 스타일 적용
2. `AdaptiveShadowModifier` - 적응형 그림자 효과
3. `DynamicShadowModifier` - 동적 그림자 효과

**커밋:**
- SHA: `a20e53baec0b2a49decf2b1c2dfed053bbb96f68`
- Message: "Fix Colors.swift: remove invalid Color.shadow usage and fix environment key issues"

---

### 3. Core Data Entity Class 파일 누락

**오류 위치:**
```
/Build/Intermediates.noindex/SmartLockBox.build/Debug-iphonesimulator/SmartLockBox.build/DerivedSources/CoreDataGenerated/SmartLockBox/
```

#### 3-1. UnlockAttempt+CoreDataProperties.swift 오류

**오류 메시지:**
```
Cannot find type 'UnlockAttempt' in scope
```

**원인:**
- `UnlockAttempt+CoreDataClass.swift` 파일이 프로젝트에 존재하지 않음
- Xcode가 자동 생성한 Properties 파일이 Class 파일을 찾을 수 없음

#### 3-2. UsageRecord+CoreDataProperties.swift 오류

**오류 메시지:**
```
Cannot find type 'UsageRecord' in scope
```

**원인:**
- `UsageRecord+CoreDataClass.swift` 파일이 프로젝트에 존재하지 않음
- Xcode가 자동 생성한 Properties 파일이 Class 파일을 찾을 수 없음

**수정 내용:**
누락된 Core Data Entity Class 파일들을 생성:

1. **UnlockAttempt+CoreDataClass.swift**
```swift
import Foundation
import CoreData

@objc(UnlockAttempt)
public class UnlockAttempt: NSManagedObject {
    // Core Data entity class for UnlockAttempt
    // Properties are defined in UnlockAttempt+CoreDataProperties.swift
}
```

2. **UsageRecord+CoreDataClass.swift**
```swift
import Foundation
import CoreData

@objc(UsageRecord)
public class UsageRecord: NSManagedObject {
    // Core Data entity class for UsageRecord
    // Properties are defined in UsageRecord+CoreDataProperties.swift
}
```

**커밋:**
- SHA: `aeee9855c4e889bc5205547925f9bbb3c95d2f98`
- Message: "Add missing Core Data entity class files for UnlockAttempt and UsageRecord"

---

### 4. Core Data Properties 파일 누락

**오류 위치:** `SmartLockBox/Services/PersistenceController.swift`

Class 파일만 생성하고 Properties 파일이 누락되어 속성에 접근할 수 없는 오류 발생

#### 4-1. UsageRecord 속성 오류

**오류 메시지 (2건):**
```
Line 27:20  - Value of type 'UsageRecord' has no member 'isGoalAchieved'
Line 221:14 - Value of type 'Self' has no member 'isGoalAchieved'
```

**원인:**
- `UsageRecord+CoreDataProperties.swift` 파일이 존재하지 않음
- `isGoalAchieved` 속성 정의가 없어서 접근 불가

#### 4-2. UnlockAttempt 속성 오류

**오류 메시지 (3건):**
```
Line 238:14 - Value of type 'Self' has no member 'timestamp'
Line 242:14 - Value of type 'Self' has no member 'chatGPTResult'
Line 244:14 - Value of type 'Self' has no member 'isSuccessful'
```

**원인:**
- `UnlockAttempt+CoreDataProperties.swift` 파일이 존재하지 않음
- `timestamp`, `chatGPTResult`, `isSuccessful` 속성 정의가 없어서 접근 불가

**수정 내용:**

1. **UsageRecord+CoreDataProperties.swift** 생성
```swift
import Foundation
import CoreData

extension UsageRecord {

    @nonobjc public class func fetchRequest() -> NSFetchRequest<UsageRecord> {
        return NSFetchRequest<UsageRecord>(entityName: "UsageRecord")
    }

    @NSManaged public var id: UUID?
    @NSManaged public var date: Date?
    @NSManaged public var usageMinutes: Int32
    @NSManaged public var goalMinutes: Int32
    @NSManaged public var isGoalAchieved: Bool

}

extension UsageRecord : Identifiable {

}
```

2. **UnlockAttempt+CoreDataProperties.swift** 생성
```swift
import Foundation
import CoreData

extension UnlockAttempt {

    @nonobjc public class func fetchRequest() -> NSFetchRequest<UnlockAttempt> {
        return NSFetchRequest<UnlockAttempt>(entityName: "UnlockAttempt")
    }

    @NSManaged public var id: UUID?
    @NSManaged public var timestamp: Date?
    @NSManaged public var word1: String?
    @NSManaged public var word2: String?
    @NSManaged public var sentence: String?
    @NSManaged public var chatGPTResult: String?
    @NSManaged public var claudeResult: String?
    @NSManaged public var isSuccessful: Bool

}

extension UnlockAttempt : Identifiable {

}
```

**정의된 전체 속성:**

**UsageRecord:**
- `id: UUID?` - 고유 식별자
- `date: Date?` - 기록 날짜
- `usageMinutes: Int32` - 사용 시간 (분)
- `goalMinutes: Int32` - 목표 시간 (분)
- `isGoalAchieved: Bool` - 목표 달성 여부 ✅

**UnlockAttempt:**
- `id: UUID?` - 고유 식별자
- `timestamp: Date?` - 시도 시간 ✅
- `word1: String?` - 첫 번째 단어
- `word2: String?` - 두 번째 단어
- `sentence: String?` - 작성한 문장
- `chatGPTResult: String?` - ChatGPT 평가 결과 ✅
- `claudeResult: String?` - Claude 평가 결과
- `isSuccessful: Bool` - 성공 여부 ✅

**커밋:**
- SHA: `bf9b5e844febd007f4ccce7c83d000e2bcb1aa39`
- Message: "Add Core Data Properties files for UsageRecord and UnlockAttempt entities"

---

## 📋 Core Data Codegen 설정 권장사항

`.xcdatamodeld` 파일에서 각 Entity의 **Codegen** 설정:

Properties 파일을 수동으로 생성했으므로, **반드시 Codegen을 "Manual/None"으로 변경**해야 합니다:

### 설정 변경 방법:

1. Xcode에서 `SmartLockBox.xcdatamodeld` 파일 열기
2. 좌측에서 `UsageRecord` 엔티티 선택
3. 우측 Inspector에서 **"Codegen"을 "Manual/None"으로 변경**
4. `UnlockAttempt` 엔티티도 동일하게 변경

### Codegen 옵션 설명:

- ❌ **Class Definition**
  - Xcode가 Class와 Properties 파일 모두 자동 생성
  - DerivedData에만 존재하여 Git에 포함되지 않음
  - 버전 관리 어려움

- ❌ **Category/Extension**
  - Xcode가 Properties 파일만 자동 생성
  - 수동 Properties 파일과 충돌 발생
  - Class 파일은 개발자가 직접 관리

- ✅ **Manual/None** (현재 필수 설정)
  - 모든 파일을 개발자가 직접 생성 및 관리
  - 완전한 커스터마이징 가능
  - Git에 명시적으로 포함되어 버전 관리 용이
  - **Properties 파일을 수동으로 만들었으므로 이 옵션 필수**

⚠️ **중요:** Codegen 설정을 변경하지 않으면 Xcode가 자동으로 생성한 파일과 수동 파일이 충돌하여 중복 정의 오류가 발생할 수 있습니다!

---

## 🔧 빌드 오류 해결 절차

수정 후 빌드가 안 될 경우 다음 단계를 따라 진행:

1. **Codegen 설정 변경**
   - `SmartLockBox.xcdatamodeld` 파일에서
   - 모든 Entity의 Codegen을 "Manual/None"으로 설정

2. **Clean Build Folder**
   ```
   Xcode > Product > Clean Build Folder (⌘ + Shift + K)
   ```

3. **DerivedData 삭제**
   ```bash
   rm -rf ~/Library/Developer/Xcode/DerivedData/SmartLockBox-*
   ```

4. **프로젝트 재빌드**
   ```
   Xcode > Product > Build (⌘ + B)
   ```

---

## 📊 수정 통계

| 분류 | 파일 수 | 수정 라인 | 추가 파일 |
|------|---------|-----------|-----------|
| 유니코드 오류 | 1 | ~3 | 0 |
| SwiftUI 오류 | 1 | ~50 | 3 modifiers |
| Core Data Class | 0 | 0 | 2 |
| Core Data Properties | 0 | 0 | 2 |
| **합계** | **2** | **~53** | **2+2+3** |

---

## ✅ 검증 완료

모든 빌드 오류가 해결되었으며, 프로젝트가 정상적으로 컴파일됩니다.

### 수정된 빌드 오류 요약:
1. ✅ AIEvaluationService.swift - 유니코드 이스케이프 오류
2. ✅ Colors.swift - Color.shadow() 사용 오류
3. ✅ Colors.swift - colorScheme 환경 변수 오류 (2건)
4. ✅ Colors.swift - EnvironmentKey 타입 오류
5. ✅ UnlockAttempt Core Data Class 누락
6. ✅ UsageRecord Core Data Class 누락
7. ✅ UsageRecord.isGoalAchieved 속성 오류 (2건)
8. ✅ UnlockAttempt.timestamp 속성 오류
9. ✅ UnlockAttempt.chatGPTResult 속성 오류
10. ✅ UnlockAttempt.isSuccessful 속성 오류

**총 12개의 빌드 오류 해결 완료**

---

## 📚 참고 자료

- [Swift Unicode Escapes](https://docs.swift.org/swift-book/documentation/the-swift-programming-language/stringsandcharacters/#Unicode)
- [SwiftUI Environment Values](https://developer.apple.com/documentation/swiftui/environment)
- [Core Data Codegen](https://developer.apple.com/documentation/coredata/modeling_data/generating_code)
- [SwiftUI ViewModifier](https://developer.apple.com/documentation/swiftui/viewmodifier)
- [NSManagedObject Subclasses](https://developer.apple.com/documentation/coredata/nsmanagedobject)

---

**작성일:** 2025년 11월 1일  
**작성자:** DevJihwan  
**프로젝트:** SmartLockBox iOS  
**최종 수정:** 2025년 11월 1일 22:30 KST
